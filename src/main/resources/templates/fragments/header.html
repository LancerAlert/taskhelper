<!-- Navigation Fragment -->
<th:block th:fragment="header">
    <nav class="bg-white/95 backdrop-blur-lg border-b border-gray-100 fixed top-0 left-0 right-0 z-50 shadow-sm">
      <div class="max-w-7xl mx-auto px-4">
        <div class="flex items-center h-16">
          <!-- Logo -->
          <div class="flex items-center space-x-2">
            <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-hands-helping text-white text-sm" aria-hidden="true"></i>
            </div>
            <span class="text-xl font-bold text-gray-900">TaskHelper</span>
          </div>

          <!-- Desktop Mega Menu -->
          <div class="hidden lg:flex items-center space-x-1 mx-auto">
            <!-- ホーム -->
            <a href="../index.html" class="px-4 py-2 text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 font-medium">
              <i class="fas fa-home mr-2"></i>ホーム
            </a>

            <!-- タスク (Mega Menu) -->
            <div class="relative group">
              <button class="px-4 py-2 text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 font-medium flex items-center">
                <i class="fas fa-tasks mr-2"></i>タスク
                <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200 group-hover:rotate-180"></i>
              </button>

              <!-- Mega Menu Dropdown -->
              <div class="absolute top-full left-0 mt-2 w-96 bg-white rounded-2xl shadow-2xl border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
                <div class="p-6">
                  <div class="grid grid-cols-1 gap-4">
                    <div>
                      <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center">
                        <i class="fas fa-plus-circle text-green-500 mr-2"></i>タスク管理
                      </h3>
                      <div class="space-y-2">
                        <a href="task-create.html" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-plus text-green-600"></i>
                          </div>
                          <div>
                            <div class="font-medium text-gray-900 group-hover/item:text-green-600">タスク作成</div>
                            <div class="text-sm text-gray-500">新しい依頼を投稿</div>
                          </div>
                        </a>
                        <a href="task-list.html" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-list text-blue-600"></i>
                          </div>
                          <div>
                            <div class="font-medium text-gray-900 group-hover/item:text-blue-600">タスク一覧</div>
                            <div class="text-sm text-gray-500">依頼を探す・応募</div>
                          </div>
                        </a>
                        <a href="my-tasks.html" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-clipboard-list text-purple-600"></i>
                          </div>
                          <div>
                            <div class="font-medium text-gray-900 group-hover/item:text-purple-600">マイタスク</div>
                            <div class="text-sm text-gray-500">進行中・完了済み</div>
                          </div>
                        </a>
                        <a href="task-progress.html" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-chart-line text-orange-600"></i>
                          </div>
                          <div>
                            <div class="font-medium text-gray-900 group-hover/item:text-orange-600">進行状況</div>
                            <div class="text-sm text-gray-500">リアルタイム追跡</div>
                          </div>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- プロフィール & アカウント (Mega Menu) -->
            <div class="relative group">
              <button class="px-4 py-2 text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 font-medium flex items-center">
                <i class="fas fa-user mr-2"></i>アカウント
                <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200 group-hover:rotate-180"></i>
              </button>

              <div class="absolute top-full left-0 mt-2 w-96 bg-white rounded-2xl shadow-2xl border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
                <div class="p-6">
                  <div class="grid grid-cols-1 gap-4">
                    <div>
                      <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center">
                        <i class="fas fa-user-circle text-blue-500 mr-2"></i>プロフィール
                      </h3>
                      <div class="space-y-2">
                        <a href="profile.html" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-user text-blue-600"></i>
                          </div>
                          <div>
                            <div class="font-medium text-gray-900 group-hover/item:text-blue-600">マイプロフィール</div>
                            <div class="text-sm text-gray-500">基本情報・設定</div>
                          </div>
                        </a>
                        <a href="user-profile-public.html" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-eye text-green-600"></i>
                          </div>
                          <div>
                            <div class="font-medium text-gray-900 group-hover/item:text-green-600">公開プロフィール</div>
                            <div class="text-sm text-gray-500">他ユーザーから見た画面</div>
                          </div>
                        </a>
                        <a href="settings.html" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-cog text-gray-600"></i>
                          </div>
                          <div>
                            <div class="font-medium text-gray-900 group-hover/item:text-gray-600">設定</div>
                            <div class="text-sm text-gray-500">通知・プライバシー</div>
                          </div>
                        </a>
                        <a href="notifications.html" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-bell text-yellow-600"></i>
                          </div>
                          <div>
                            <div class="font-medium text-gray-900 group-hover/item:text-yellow-600">通知</div>
                            <div class="text-sm text-gray-500">メッセージ・更新情報</div>
                          </div>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- コミュニティ (Mega Menu) -->
            <div class="relative group">
              <button class="px-4 py-2 text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 font-medium flex items-center">
                <i class="fas fa-users mr-2"></i>コミュニティ
                <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200 group-hover:rotate-180"></i>
              </button>

              <div class="absolute top-full left-0 mt-2 w-96 bg-white rounded-2xl shadow-2xl border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
                <div class="p-6">
                  <div class="grid grid-cols-1 gap-4">
                    <div>
                      <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center">
                        <i class="fas fa-trophy text-yellow-500 mr-2"></i>コミュニティ & 成果
                      </h3>
                      <div class="space-y-2">
                        <a href="leaderboard.html" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-ranking-star text-yellow-600"></i>
                          </div>
                          <div>
                            <div class="font-medium text-gray-900 group-hover/item:text-yellow-600">ランキング</div>
                            <div class="text-sm text-gray-500">トップヘルパー</div>
                          </div>
                        </a>
                        <a href="achievement-center.html" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-medal text-purple-600"></i>
                          </div>
                          <div>
                            <div class="font-medium text-gray-900 group-hover/item:text-purple-600">成果センター</div>
                            <div class="text-sm text-gray-500">バッジ・レベル</div>
                          </div>
                        </a>
                        <a href="testimonials.html" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-quote-right text-green-600"></i>
                          </div>
                          <div>
                            <div class="font-medium text-gray-900 group-hover/item:text-green-600">お客様の声</div>
                            <div class="text-sm text-gray-500">レビュー・体験談</div>
                          </div>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- その他 (Mega Menu) -->
            <div class="relative group">
              <button class="px-4 py-2 text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 font-medium flex items-center">
                <i class="fas fa-ellipsis-h mr-2"></i>その他
                <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200 group-hover:rotate-180"></i>
              </button>

              <div class="absolute top-full right-0 mt-2 w-80 bg-white rounded-2xl shadow-2xl border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
                <div class="p-6">
                  <div class="space-y-4">
                    <!-- 機能・ツール -->
                    <div>
                      <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center">
                        <i class="fas fa-tools text-indigo-500 mr-2"></i>機能・ツール
                      </h3>
                      <div class="grid grid-cols-2 gap-2">
                        <a href="search.html" class="flex flex-col items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <i class="fas fa-search text-gray-600 mb-1"></i>
                          <span class="text-xs font-medium">検索</span>
                        </a>
                        <a href="messages.html" class="flex flex-col items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <i class="fas fa-comments text-blue-600 mb-1"></i>
                          <span class="text-xs font-medium">メッセージ</span>
                        </a>
                        <a href="favorites.html" class="flex flex-col items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <i class="fas fa-heart text-red-600 mb-1"></i>
                          <span class="text-xs font-medium">お気に入り</span>
                        </a>
                        <a href="payment.html" class="flex flex-col items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <i class="fas fa-credit-card text-green-600 mb-1"></i>
                          <span class="text-xs font-medium">決済</span>
                        </a>
                        <a href="earnings.html" class="flex flex-col items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <i class="fas fa-yen-sign text-purple-600 mb-1"></i>
                          <span class="text-xs font-medium">収益</span>
                        </a>
                        <a href="reviews.html" class="flex flex-col items-center p-3 rounded-lg hover:bg-gray-50 transition-colors group/item">
                          <i class="fas fa-star text-yellow-600 mb-1"></i>
                          <span class="text-xs font-medium">レビュー</span>
                        </a>
                      </div>
                    </div>

                    <!-- サポート -->
                    <div>
                      <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center">
                        <i class="fas fa-life-ring text-orange-500 mr-2"></i>サポート
                      </h3>
                      <div class="space-y-2">
                        <a href="help.html" class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                          <i class="fas fa-question-circle text-blue-600 mr-3"></i>
                          ヘルプセンター
                        </a>
                        <a href="dispute-resolution.html" class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                          <i class="fas fa-gavel text-red-600 mr-3"></i>
                          分争解決
                        </a>
                        <a href="onboarding-guide.html" class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                          <i class="fas fa-route text-purple-600 mr-3"></i>
                          ガイドツアー
                        </a>
                      </div>
                    </div>

                    <!-- 会社情報 -->
                    <div>
                      <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center">
                        <i class="fas fa-building text-gray-500 mr-2"></i>会社情報
                      </h3>
                      <div class="grid grid-cols-2 gap-2 text-xs">
                        <a href="about.html" class="p-2 rounded-lg hover:bg-gray-50 transition-colors text-center">会社概要</a>
                        <a href="terms.html" class="p-2 rounded-lg hover:bg-gray-50 transition-colors text-center">利用規約</a>
                        <a href="privacy-policy.html" class="p-2 rounded-lg hover:bg-gray-50 transition-colors text-center">プライバシー</a>
                        <a href="helper-onboarding.html" class="p-2 rounded-lg hover:bg-gray-50 transition-colors text-center">ヘルパー登録</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Auth Buttons -->
          <div class="hidden lg:flex items-center space-x-3">
            <a href="login.html" class="border border-blue-600 text-blue-600 px-6 py-2 rounded-lg font-semibold hover:bg-blue-50 transition-all duration-200 hover:scale-105">ログイン</a>
            <a href="register.html" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-2 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200 hover:scale-105 shadow-lg">始める</a>
          </div>

          <!-- Mobile Menu Button -->
          <div class="lg:hidden ml-auto">
            <button id="mobile-menu-button" class="text-gray-700 hover:text-blue-600 p-2 transition-all duration-300 ease-in-out" aria-expanded="false">
              <svg class="w-6 h-6 transition-transform duration-300 ease-in-out" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path id="menu-icon" class="transition-opacity duration-300" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                <path id="close-icon" class="transition-opacity duration-300 opacity-0" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden lg:hidden pb-4 transition-all duration-300 ease-in-out transform border-t border-gray-100 mt-4">
          <div class="flex flex-col space-y-1 pt-4">
            <!-- 基本メニュー -->
            <a href="../index.html" class="flex items-center px-4 py-3 text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
              <i class="fas fa-home mr-3 w-5"></i>ホーム
            </a>
            <a href="task-list.html" class="flex items-center px-4 py-3 text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
              <i class="fas fa-list mr-3 w-5"></i>タスク一覧
            </a>
            <a href="task-create.html" class="flex items-center px-4 py-3 text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
              <i class="fas fa-plus mr-3 w-5"></i>タスク作成
            </a>
            <a href="my-tasks.html" class="flex items-center px-4 py-3 text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
              <i class="fas fa-clipboard-list mr-3 w-5"></i>マイタスク
            </a>

            <!-- 展開可能セクション -->
            <div class="mobile-section">
              <button class="mobile-section-toggle w-full flex items-center justify-between px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors" data-target="profile-section">
                <span class="flex items-center">
                  <i class="fas fa-user mr-3 w-5"></i>プロフィール
                </span>
                <i class="fas fa-chevron-down transition-transform duration-200"></i>
              </button>
              <div id="profile-section" class="hidden pl-8 space-y-1">
                <a href="profile.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-user-circle mr-3 w-4"></i>マイプロフィール
                </a>
                <a href="settings.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-cog mr-3 w-4"></i>設定
                </a>
                <a href="notifications.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-bell mr-3 w-4"></i>通知
                </a>
              </div>
            </div>

            <div class="mobile-section">
              <button class="mobile-section-toggle w-full flex items-center justify-between px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors" data-target="community-section">
                <span class="flex items-center">
                  <i class="fas fa-users mr-3 w-5"></i>コミュニティ
                </span>
                <i class="fas fa-chevron-down transition-transform duration-200"></i>
              </button>
              <div id="community-section" class="hidden pl-8 space-y-1">
                <a href="leaderboard.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-trophy mr-3 w-4"></i>ランキング
                </a>
                <a href="achievement-center.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-medal mr-3 w-4"></i>成果センター
                </a>
                <a href="testimonials.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-quote-right mr-3 w-4"></i>お客様の声
                </a>
              </div>
            </div>

            <div class="mobile-section">
              <button class="mobile-section-toggle w-full flex items-center justify-between px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors" data-target="tools-section">
                <span class="flex items-center">
                  <i class="fas fa-tools mr-3 w-5"></i>ツール
                </span>
                <i class="fas fa-chevron-down transition-transform duration-200"></i>
              </button>
              <div id="tools-section" class="hidden pl-8 space-y-1">
                <a href="search.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-search mr-3 w-4"></i>検索
                </a>
                <a href="messages.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-comments mr-3 w-4"></i>メッセージ
                </a>
                <a href="favorites.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-heart mr-3 w-4"></i>お気に入り
                </a>
                <a href="payment.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-credit-card mr-3 w-4"></i>決済
                </a>
                <a href="earnings.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-yen-sign mr-3 w-4"></i>収益
                </a>
              </div>
            </div>

            <div class="mobile-section">
              <button class="mobile-section-toggle w-full flex items-center justify-between px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors" data-target="support-section">
                <span class="flex items-center">
                  <i class="fas fa-life-ring mr-3 w-5"></i>サポート
                </span>
                <i class="fas fa-chevron-down transition-transform duration-200"></i>
              </button>
              <div id="support-section" class="hidden pl-8 space-y-1">
                <a href="help.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-question-circle mr-3 w-4"></i>ヘルプ
                </a>
                <a href="dispute-resolution.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-gavel mr-3 w-4"></i>分争解決
                </a>
                <a href="onboarding-guide.html" class="flex items-center px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                  <i class="fas fa-route mr-3 w-4"></i>ガイドツアー
                </a>
              </div>
            </div>

            <!-- 認証ボタン -->
            <hr class="my-4">
            <div class="flex gap-3 px-4">
              <a href="login.html" class="flex-1 border border-blue-600 text-blue-600 px-4 py-3 rounded-lg font-semibold hover:bg-blue-50 text-center transition-colors">ログイン</a>
              <a href="register.html" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 text-center transition-colors">始める</a>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- CSS Styles -->
    <style>
    /* メガメニューのアニメーション */
    .group:hover .group-hover\:opacity-100 {
      animation: fadeInUp 0.3s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ホバー効果の強化 */
    .group\/item:hover {
      transform: translateX(4px);
    }

    /* モバイルセクションのアニメーション */
    .mobile-section .mobile-section-toggle.active i {
      transform: rotate(180deg);
    }

    /* スクロール時のヘッダー効果 */
    .header-scrolled {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    </style>

    <!-- JavaScript -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Mobile menu functionality
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      const menuIcon = document.getElementById('menu-icon');
      const closeIcon = document.getElementById('close-icon');

      if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', function() {
          const isExpanded = this.getAttribute('aria-expanded') === 'true';
          this.setAttribute('aria-expanded', !isExpanded);
          mobileMenu.classList.toggle('hidden');

          // Toggle menu/close icons
          if (menuIcon && closeIcon) {
            menuIcon.classList.toggle('opacity-0');
            closeIcon.classList.toggle('opacity-0');
          }
        });
      }

      // Mobile section toggles
      const sectionToggles = document.querySelectorAll('.mobile-section-toggle');
      sectionToggles.forEach(toggle => {
        toggle.addEventListener('click', function() {
          const targetId = this.getAttribute('data-target');
          const targetSection = document.getElementById(targetId);
          const chevron = this.querySelector('i:last-child');

          if (targetSection) {
            targetSection.classList.toggle('hidden');
            this.classList.toggle('active');
          }
        });
      });

      // Header scroll effect
      let lastScrollTop = 0;
      const header = document.querySelector('nav');

      window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

        if (scrollTop > 100) {
          header.classList.add('header-scrolled');
        } else {
          header.classList.remove('header-scrolled');
        }

        lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
      });

      // Close mobile menu when clicking outside
      document.addEventListener('click', function(event) {
        if (!mobileMenuButton.contains(event.target) && !mobileMenu.contains(event.target)) {
          mobileMenu.classList.add('hidden');
          mobileMenuButton.setAttribute('aria-expanded', 'false');
          if (menuIcon && closeIcon) {
            menuIcon.classList.remove('opacity-0');
            closeIcon.classList.add('opacity-0');
          }
        }
      });

      // Keyboard navigation for accessibility
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          mobileMenu.classList.add('hidden');
          mobileMenuButton.setAttribute('aria-expanded', 'false');
          if (menuIcon && closeIcon) {
            menuIcon.classList.remove('opacity-0');
            closeIcon.classList.add('opacity-0');
          }
        }
      });
    });
    </script>
</th:block>