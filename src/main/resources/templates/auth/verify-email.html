<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>メール認証 - TaskHelper | 近所の信頼できる代行サービス</title>
  
  <!-- CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- CSS Libraries -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <!-- Additional UI Libraries -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.10.1/sweetalert2.min.css" rel="stylesheet">
  
  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <!-- Custom CSS -->
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .form-container {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    
    .bounce-animation {
      animation: bounceIn 0.8s ease-out;
    }
    
    @keyframes bounceIn {
      0% {
        opacity: 0;
        transform: scale(0.3) translateY(-50px);
      }
      50% {
        opacity: 1;
        transform: scale(1.05) translateY(0);
      }
      70% {
        transform: scale(0.9);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .pulse-animation {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(37, 99, 235, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(37, 99, 235, 0);
      }
    }
    
    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }
    
    @keyframes fadeIn {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-blue-50 via-white to-green-50 min-h-screen">

<!-- Navigation -->
<nav class="bg-white shadow-sm fixed top-0 left-0 right-0 z-50">
  <div class="max-w-7xl mx-auto px-4">
    <div class="flex items-center h-16">
      <!-- Logo -->
      <div class="flex items-center space-x-2">
        <i class="fas fa-hands-helping text-2xl text-blue-600" aria-hidden="true"></i>
        <span class="text-xl font-bold text-gray-900">TaskHelper</span>
      </div>
      
      <!-- Desktop Menu (centered) -->
      <div class="hidden md:flex items-center space-x-8 mx-auto">
        <a href="../index.html" class="text-gray-700 hover:text-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:rounded px-2 py-1 no-underline">ホーム</a>
        <a href="../tasks/task-list.html" class="text-gray-700 hover:text-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:rounded px-2 py-1 no-underline">依頼一覧</a>
        <a href="../tasks/task-create.html" class="text-gray-700 hover:text-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:rounded px-2 py-1 no-underline">依頼投稿</a>
        <a href="../user/user-profile.html" class="text-gray-700 hover:text-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:rounded px-2 py-1 no-underline">プロフィール</a>
        <a href="../tasks/my-tasks.html" class="text-gray-700 hover:text-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:rounded px-2 py-1 no-underline">マイタスク</a>
      </div>
      
      <!-- Auth Buttons -->
      <div class="hidden md:flex items-center space-x-3">
        <a href="login.html" class="border border-blue-600 text-blue-600 px-6 py-2 rounded-lg font-semibold hover:bg-blue-50 transition-colors focus:outline-none focus:ring-4 focus:ring-blue-300">ログイン</a>
        <a href="register.html" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors focus:outline-none focus:ring-4 focus:ring-blue-300">始める</a>
      </div>
      
      <!-- Mobile Menu Button -->
      <div class="md:hidden ml-auto">
        <button id="mobile-menu-button" class="text-gray-700 hover:text-blue-600 p-2 transition-all duration-300 ease-in-out" aria-expanded="false">
          <svg class="w-6 h-6 transition-transform duration-300 ease-in-out" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path id="menu-icon" class="transition-opacity duration-300" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            <path id="close-icon" class="transition-opacity duration-300 opacity-0" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden md:hidden pb-4 transition-all duration-300 ease-in-out transform">
      <div class="flex flex-col space-y-2">
        <a href="../index.html" class="block px-3 py-2 text-gray-700 hover:text-blue-600 hover:bg-gray-50 rounded focus:outline-none focus:ring-2 focus:ring-blue-400">ホーム</a>
        <a href="../tasks/task-list.html" class="block px-3 py-2 text-gray-700 hover:text-blue-600 hover:bg-gray-50 rounded focus:outline-none focus:ring-2 focus:ring-blue-400">依頼一覧</a>
        <a href="../tasks/task-create.html" class="block px-3 py-2 text-gray-700 hover:text-blue-600 hover:bg-gray-50 rounded focus:outline-none focus:ring-2 focus:ring-blue-400">依頼投稿</a>
        <a href="../user/user-profile.html" class="block px-3 py-2 text-gray-700 hover:text-blue-600 hover:bg-gray-50 rounded focus:outline-none focus:ring-2 focus:ring-blue-400">プロフィール</a>
        <a href="../tasks/my-tasks.html" class="block px-3 py-2 text-gray-700 hover:text-blue-600 hover:bg-gray-50 rounded focus:outline-none focus:ring-2 focus:ring-blue-400">マイタスク</a>
        <hr class="my-3">
        <div class="flex gap-2 justify-center">
          <a href="login.html" class="border border-blue-600 text-blue-600 px-4 py-2 rounded-lg font-semibold hover:bg-blue-50 text-center transition-colors focus:outline-none focus:ring-4 focus:ring-blue-300">ログイン</a>
          <a href="register.html" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 text-center transition-colors focus:outline-none focus:ring-4 focus:ring-blue-300">始める</a>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Main Content -->
<main class="flex items-center justify-center min-h-screen pt-20 pb-8 px-4" x-data="verifyEmailApp()">
  <div class="w-full max-w-lg">

    <!-- Form Container -->
    <div class="form-container rounded-2xl p-8 shadow-2xl">
      
      <!-- Loading State -->
      <div x-show="verificationStatus === 'loading'" class="text-center space-y-6">
        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto">
          <i class="fas fa-spinner fa-spin text-2xl text-blue-600"></i>
        </div>
        <div>
          <h1 class="text-2xl font-bold text-gray-900 mb-2">メール認証中...</h1>
          <p class="text-gray-600">認証処理を行っています。しばらくお待ちください。</p>
        </div>
      </div>

      <!-- Success State -->
      <div x-show="verificationStatus === 'success'" class="text-center space-y-6 bounce-animation">
        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto pulse-animation">
          <i class="fas fa-check text-3xl text-green-600"></i>
        </div>
        <div class="fade-in">
          <h1 class="text-2xl font-bold text-gray-900 mb-2">メール認証が完了しました！</h1>
          <p class="text-gray-600 mb-4">
            ようこそ、TaskHelperへ！<br>
            アカウントが正常に認証されました。
          </p>
          <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-left">
            <div class="flex items-start">
              <i class="fas fa-gift text-green-600 mr-3 mt-0.5"></i>
              <div class="text-sm text-green-800">
                <p class="font-medium mb-1">新規登録特典</p>
                <ul class="list-disc list-inside space-y-1">
                  <li>初回タスク投稿手数料 無料</li>
                  <li>プロフィール認証で信頼度アップ</li>
                  <li>コミュニティガイドラインをチェック</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        
        <div class="space-y-3 fade-in">
          <a href="../user/user-profile.html" class="block w-full bg-blue-600 text-white py-4 rounded-lg font-semibold hover:bg-blue-700 hover:scale-105 transition-all duration-200">
            プロフィールを設定
          </a>
          <a href="../tasks/task-list.html" class="block w-full border border-blue-600 text-blue-600 py-3 rounded-lg font-semibold hover:bg-blue-50 transition-colors">
            依頼一覧を見る
          </a>
          <a href="../index.html" class="block w-full text-gray-600 py-3 rounded-lg hover:bg-gray-50 transition-colors">
            ホームに戻る
          </a>
        </div>
      </div>

      <!-- Error State -->
      <div x-show="verificationStatus === 'error'" class="text-center space-y-6">
        <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto">
          <i class="fas fa-times text-2xl text-red-600"></i>
        </div>
        <div>
          <h1 class="text-2xl font-bold text-gray-900 mb-2">認証に失敗しました</h1>
          <p class="text-gray-600" x-text="errorMessage"></p>
        </div>
        
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
          <div class="flex items-start">
            <i class="fas fa-exclamation-triangle text-red-600 mr-3 mt-0.5"></i>
            <div class="text-sm text-red-800">
              <p class="font-medium mb-1">考えられる原因：</p>
              <ul class="list-disc list-inside space-y-1">
                <li>リンクの有効期限が切れている（24時間）</li>
                <li>既に認証済みのアカウント</li>
                <li>不正なリンクまたは改変されたリンク</li>
                <li>一時的なシステムエラー</li>
              </ul>
            </div>
          </div>
        </div>
        
        <div class="space-y-3">
          <button @click="resendVerification()" 
                  class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors"
                  :disabled="resendCooldown > 0"
                  :class="resendCooldown > 0 ? 'opacity-75 cursor-not-allowed' : ''">
            <span x-show="resendCooldown === 0">認証メールを再送信</span>
            <span x-show="resendCooldown > 0" x-text="`再送信まで ${resendCooldown}秒`"></span>
          </button>
          <a href="register.html" class="block w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-colors">
            新規登録をやり直す
          </a>
          <a href="login.html" class="block w-full text-blue-600 py-3 rounded-lg hover:bg-blue-50 transition-colors">
            ログインページへ
          </a>
        </div>
      </div>

      <!-- Expired State -->
      <div x-show="verificationStatus === 'expired'" class="text-center space-y-6">
        <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto">
          <i class="fas fa-clock text-2xl text-yellow-600"></i>
        </div>
        <div>
          <h1 class="text-2xl font-bold text-gray-900 mb-2">リンクの有効期限が切れています</h1>
          <p class="text-gray-600">
            認証リンクの有効期限は24時間です。<br>
            新しい認証メールをお送りします。
          </p>
        </div>
        
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <div class="flex items-start">
            <i class="fas fa-info-circle text-yellow-600 mr-3 mt-0.5"></i>
            <div class="text-sm text-yellow-800">
              <p class="font-medium mb-1">セキュリティのため：</p>
              <p>認証リンクには有効期限があります。期限が切れた場合は、新しいリンクを取得してください。</p>
            </div>
          </div>
        </div>
        
        <div class="space-y-3">
          <button @click="resendVerification()" 
                  class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors"
                  :disabled="resendCooldown > 0"
                  :class="resendCooldown > 0 ? 'opacity-75 cursor-not-allowed' : ''">
            <span x-show="resendCooldown === 0">新しい認証メールを送信</span>
            <span x-show="resendCooldown > 0" x-text="`再送信まで ${resendCooldown}秒`"></span>
          </button>
          <a href="login.html" class="block w-full text-gray-600 py-3 rounded-lg hover:bg-gray-50 transition-colors">
            ログインページに戻る
          </a>
        </div>
      </div>

      <!-- Already Verified State -->
      <div x-show="verificationStatus === 'already-verified'" class="text-center space-y-6">
        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto">
          <i class="fas fa-user-check text-2xl text-blue-600"></i>
        </div>
        <div>
          <h1 class="text-2xl font-bold text-gray-900 mb-2">既に認証済みです</h1>
          <p class="text-gray-600">
            このアカウントは既にメール認証が完了しています。<br>
            ログインしてTaskHelperをご利用ください。
          </p>
        </div>
        
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <div class="flex items-start">
            <i class="fas fa-lightbulb text-blue-600 mr-3 mt-0.5"></i>
            <div class="text-sm text-blue-800">
              <p class="font-medium mb-1">ご利用可能な機能：</p>
              <ul class="list-disc list-inside space-y-1">
                <li>タスクの投稿・応募</li>
                <li>メッセージ機能</li>
                <li>評価・レビュー機能</li>
                <li>すべてのコミュニティ機能</li>
              </ul>
            </div>
          </div>
        </div>
        
        <div class="space-y-3">
          <a href="login.html" class="block w-full bg-blue-600 text-white py-4 rounded-lg font-semibold hover:bg-blue-700 hover:scale-105 transition-all duration-200">
            ログインする
          </a>
          <a href="../index.html" class="block w-full text-gray-600 py-3 rounded-lg hover:bg-gray-50 transition-colors">
            ホームに戻る
          </a>
        </div>
      </div>
    </div>

    <!-- Help Section -->
    <div class="mt-8 text-center">
      <p class="text-gray-600 text-sm mb-4">
        問題が解決しませんか？
      </p>
      <div class="space-x-4">
        <a href="../support/help.html" class="text-blue-600 hover:text-blue-700 text-sm">
          <i class="fas fa-question-circle mr-1"></i>
          ヘルプセンター
        </a>
        <a href="help.html#contact" class="text-blue-600 hover:text-blue-700 text-sm">
          <i class="fas fa-envelope mr-1"></i>
          お問い合わせ
        </a>
      </div>
    </div>
  </div>
</main>

<!-- JavaScript Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.10.1/sweetalert2.all.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Mobile menu functionality
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');
  
  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener('click', function() {
      const isExpanded = this.getAttribute('aria-expanded') === 'true';
      this.setAttribute('aria-expanded', !isExpanded);
      mobileMenu.classList.toggle('hidden');
      
      // Toggle menu/close icons
      if (menuIcon && closeIcon) {
        menuIcon.classList.toggle('opacity-0');
        closeIcon.classList.toggle('opacity-0');
      }
    });
    
    // Close menu when clicking links
    mobileMenu.addEventListener('click', function(event) {
      if (event.target.tagName === 'A') {
        mobileMenu.classList.add('hidden');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
        if (menuIcon && closeIcon) {
          menuIcon.classList.remove('opacity-0');
          closeIcon.classList.add('opacity-0');
        }
      }
    });
  }
});

// Verify Email App using Alpine.js
function verifyEmailApp() {
  return {
    verificationStatus: 'loading', // loading, success, error, expired, already-verified
    errorMessage: '',
    resendCooldown: 0,
    
    async init() {
      // Get verification token from URL
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');
      const email = urlParams.get('email');
      
      if (!token) {
        this.verificationStatus = 'error';
        this.errorMessage = '認証トークンが見つかりません。認証メールのリンクが正しいかご確認ください。';
        return;
      }
      
      // Simulate verification process
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      // Simulate different verification outcomes
      if (token === 'expired') {
        this.verificationStatus = 'expired';
      } else if (token === 'invalid') {
        this.verificationStatus = 'error';
        this.errorMessage = '認証トークンが無効です。リンクが改変されているか、既に使用済みの可能性があります。';
      } else if (token === 'already-verified') {
        this.verificationStatus = 'already-verified';
      } else if (token === 'server-error') {
        this.verificationStatus = 'error';
        this.errorMessage = 'サーバーエラーが発生しました。しばらく時間をおいて再度お試しください。';
      } else {
        // Success case (token === 'valid' or any other value)
        this.verificationStatus = 'success';
        toastr.success('メール認証が完了しました！');
      }
    },
    
    async resendVerification() {
      if (this.resendCooldown > 0) return;
      
      try {
        // Simulate API call
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        toastr.success('認証メールを再送信しました');
        this.startResendCooldown();
        
        // Show additional instruction
        toastr.info('メールをご確認ください。迷惑メールフォルダもチェックしてください。');
        
      } catch (error) {
        toastr.error('メールの再送信に失敗しました');
      }
    },
    
    startResendCooldown() {
      this.resendCooldown = 60;
      const timer = setInterval(() => {
        this.resendCooldown--;
        if (this.resendCooldown <= 0) {
          clearInterval(timer);
        }
      }, 1000);
    }
  }
}

// Configure Toastr
toastr.options = {
  "closeButton": true,
  "progressBar": true,
  "positionClass": "toast-top-right",
  "timeOut": "4000"
};
</script>

</body>
</html>